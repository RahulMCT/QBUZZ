/*
-- -------------------------------------------------------------------------------
--
-- Copyright Â© 2022 by Spectades BV
--
-- Filename    : QBUZZ_external_wsjobo.txt
--
-- Description : Extensible Framework JavaScript WSJOBO - New Tab on WSJOBO
-
-- Product     : EAM             Release : 11.7          
--
-- Author      :MCT
--
-- CHANGE HISTORY
--
-- 0001 21-09-2022 - MCT - WSJOBO - New Tab on WSJOBO
-- 0002 03-10-2022 - MCT - Issues Fixed  
-- 0003 04-10-2022 - MCT - Work Order Control 
-- 0004 31-10-2022 - SPC-288 When monthly invoicing is not checked, an extra 'control popup' is necessary in both the language.
-- 0005 01-11-2022 - SPC-290 protect the "Add new Part" block when "Part Not Exist" checkbox is unchecked, and vice-versa.
										 
											  
-- -------------------------------------------------------------------------------
*/

var headerData = null;
var userFunction = 'WSJOBO';
var userFunctionTab = 'U1';
var webservicePromptCode = 'WSJOBO';
var DEBUG = false;
var vcurrentRecord = "";
var myDropDown = "";
var vUser = "";
var vLang = "";
var vCopyClicked = "";
var vCheck = "";
var vPartDescFld = "";
var vQtyDescFld = "";
var vAsstDescFld = "";
var vReqDemob = "";
var vTspMode = "";
var vByAsset = "";
var vSerialNo = "";
var vRecHeightUOM = "";
var vRecWidthUOM = "";
var vErrorFlag = false;
var canAddSubpackages = false;
var vHeaderText = "";
var dummyContainerRefField = null;
var vBaseTitle = "";
var vSubPckCode = "";
var theRealField = "";
var vpkgHasSubpackages = "";
var resetClicked = false;
var vparentPackFlag = false;
var vpkgHasNonTRParts = "";
var vWidthUOM = "";
var vHeightUOM = "";
var vWeightUOM = "";
var vRecGrossWtUOM = "";
var vRecNetWtUOM = "";
var gListFieldName = "";
var gStatusCode = ""; //Global variable to store status code and description
var gStatusAuth = ""; //Global variable to store status authorization
var gStatusValue = "";
var MODE_LISTVIEW = "LISTVIEW";
var MODE_RECORDVIEW = "RECORDVIEW";
var gGlobalClass = "";
var gContainerWarning = "";
var gContainerRefHyperlinkFlag = "FALSE";
var vworkorderstatus = "";

Ext.define('EAM.custom.external_wsjobo', {
    extend: 'EAM.custom.AbstractExtensibleFramework',
    getSelectors: function () {
        thisContext = this;
        return {
        
            '[extensibleFramework] [tabName=HDR] uxcombobox[name=workorderstatus]': {
                select: function (a, b) {
                  try{
                  
                           EAM.Utils.debugMessage("status change function called !");
                            var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.getFldValue("workorderstatus");
                            EAM.Utils.debugMessage(" headerStatus afterrender function called !"+ gStatusValue);
                            var vPageData = formPanel.responseData.pageData;
                            vUser = EAM.AppData.getUser();
                            vLang = EAM.AppData.getLanguage();
                            var userGroup = getUserGroup();
							/*To generate a popup for type Damage or Monthly Invoice checked*/
							var vworkOrder = formPanel.getFldValue("workordertype");
                        EAM.Utils.debugMessage("workordertype afterrender function called " + vworkOrder);
                        EAM.Utils.debugMessage("old status value is " + vworkorderstatus);
                        if (vworkorderstatus === 'TCS') {
                            if (vworkOrder === 'SCH' && headerStatus === 'AG') {
                                //var vReturnVar = true;
                                showPopup();
                                //return vReturnVar;
                            } else if (vworkOrder != 'SCH' && headerStatus === 'AG') {
                                var vSupplier = formPanel.getFldValue("udfchar19");
                                var requestData = {
                                    GRID_NAME: "NUSUPP",
                                    GRID_TYPE: "LOV",
                                    REQUEST_TYPE: "LOV.HEAD_DATA.STORED",
                                    LOV_ALIAS_NAME_1: "parameter.comcode",
                                    LOV_ALIAS_VALUE_1: vSupplier,
                                    LOV_ALIAS_TYPE_1: "text",
                                    LOV_ALIAS_NAME_2: "parameter.comorg",
                                    LOV_ALIAS_VALUE_2: "*",
                                    LOV_ALIAS_TYPE_2: "text",

                                    CURRENT_TAB_NAME: "HDR",
                                    USER_FUNCTION_NAME: "WSJOBO",
                                    SYSTEM_FUNCTION_NAME: "WSJOBO",
                                    COMPONENT_INFO_TYPE: "DATA_ONLY"
                                };

                                var response = EAM.Ajax.request({
                                    url: "LOVPOP",
                                    params: requestData
                                });
                                var vrecords = response.responseData.pageData.grid.GRIDRESULT.GRID.DATA[0].commonchk;

                                EAM.Utils.debugMessage("vrecords is " + vrecords);

                                if (vrecords === 'N') {
                                    showPopup();
                                }

                            }

                        }
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                                protectAllFields('HDR',formPanel);
                                return;
                            }
                            else{
                                protectHdrField(formPanel, "");
                            }
							
							                        
                        
                        
                        //EAM.Utils.debugMessage(" headerStatus afterrender function called " + headerStatus);
                        
                            
                  } catch (e) {
                            EAM.Utils.debugMessage('Error in After Render : ' + e);
                  }
                }
            },
            
             '[extensibleFramework] [tabName=HDR]': {
                afterrender: function (a, b) {
                  try{
                  
                           EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                             var headerStatus = formPanel.getFldValue("workorderstatus");
                             var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                                protectAllFields('HDR',formPanel);
                                return;
                            }
                            else{
                                protectHdrField(formPanel, "");
                            }
                  } catch (e) {
                            EAM.Utils.debugMessage('Error in After Render : ' + e);
                  }
                },
                aftersaverecord: function (a, b, c) {
                    try{
                  
                           EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.getFldValue("workorderstatus");
							
							vworkorderstatus = formPanel.getFldValue("workorderstatus");
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                                protectAllFields('HDR',formPanel);
                                return;
                            }
                            else{
                                protectHdrField(formPanel, "");
                            }
							
							
                  } catch (e) {
                            EAM.Utils.debugMessage('Error in After Render : ' + e);
                  }
                },
                afterrecordchange: function (a, b) {
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.getFldValue("workorderstatus");
							vworkorderstatus = formPanel.getFldValue("workorderstatus");
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "CA" || headerStatus === "TF"){
                                protectAllFields('HDR',formPanel);
                                return;
                            }
                            else{
                                protectHdrField(formPanel, "");
                            }
                },
                afterloadrecord: function (a) {
                    

                },
                afterreset: function (a, b) {
                 var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.getFldValue("workorderstatus");
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                                protectAllFields('HDR',formPanel);
                                return;
                            }
                            else{
                                protectHdrField(formPanel, "");
                            }

                }
            },
            '[extensibleFramework] uxtabpanel[itemId=tabContent]': {
                aftertabchange:  function (field, event) {
                debugger;
                    var formPanel = this.getFormPanel();
                    EAM.Utils.debugMessage("beforetriggerclick of wspf_10_ou_parts called !");
                    //overridelovfield(formPanel, field);
                    
                }
            },
            '[extensibleFramework] [tabName=U1] lovfield[name=wspf_10_ou_parts]': {
                beforetriggerclick: function (field, event) {
                    var formPanel = this.getFormPanel();
                    EAM.Utils.debugMessage("beforetriggerclick of wspf_10_ou_parts called !");
                    overridelovfield(formPanel, field);
                    
                }
            },
            '[extensibleFramework] [tabName=U1] lovfield[name=wspf_10_ou_toh]': {
                beforetriggerclick: function (field, event) {
                    var formPanel = this.getFormPanel();
                    EAM.Utils.debugMessage("beforetriggerclick of wspf_10_ou_toh called !");
                    overridelovfield(formPanel, field);
                    
                }
            },
            '[extensibleFramework] [tabName=U1]': {
                afterrender: function (a, b) {
                  try{
                  EAM.Utils.debugMessage("afterrender function called !");
                  debugger;
                            var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(userFunctionTab,formPanel);
                            return;
                            }
                            else{
                            resetButtons(a.tabName,formPanel);
                            setU1DefaultValues(formPanel,"");
                            setDropDowns(formPanel,"wspf_10_ou_act");
                            }
                            
                    
                                     
                  } catch (e) {
                            EAM.Utils.debugMessage('Error in After Render : ' + e);
                  }
                },
                afterloadrecord: function (a, b, c) {
                EAM.Utils.debugMessage("afterloadrecord function called !");
                             var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            setActivityStore(formPanel);
                             gActivityValue = formPanel.getFldValue("wspf_10_ou_act");
                             var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(userFunctionTab,formPanel);
                            return;
                            }
                            else{
                                                        resetButtons(a.tabName,formPanel);

                            setU1DefaultValues(formPanel,"");
                            }

                },
                afterrecordchange: function (a, b) {
                  EAM.Utils.debugMessage("afterrender function called !");
                             var formPanel = this.getFormPanel();
                             setActivityStore(formPanel);
                              gActivityValue = formPanel.getFldValue("wspf_10_ou_act");
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(userFunctionTab,formPanel);
                            return;
                            }
                            else{
                                                        resetButtons(a.tabName,formPanel);

                            setU1DefaultValues(formPanel,"");
                            }

                },
                afternewrecord: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                     setActivityStore(formPanel);
                      gActivityValue = formPanel.getFldValue("wspf_10_ou_act");
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(userFunctionTab,formPanel);
                            return;
                            }
                            else{
                            resetButtons(a.tabName,formPanel);
                            setU1DefaultValues(formPanel,"");
                            }

                },
                afterreset: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                     setActivityStore(formPanel);
                      gActivityValue = formPanel.getFldValue("wspf_10_ou_act");
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(userFunctionTab,formPanel);
                            return;
                            }
                            else{
                            resetButtons(a.tabName,formPanel);
                            setU1DefaultValues(formPanel,"");
                            }
                },
                aftersaverecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                     setActivityStore(formPanel);
                      gActivityValue = formPanel.getFldValue("wspf_10_ou_act");
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(userFunctionTab,formPanel);
                            return;
                            }
                            else{
                            resetButtons(a.tabName,formPanel);
                            setU1DefaultValues(formPanel,"");
                            }
                },
                afterdestroyrecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                     setActivityStore(formPanel);
                      gActivityValue = formPanel.getFldValue("wspf_10_ou_act");
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(userFunctionTab,formPanel);
                            return;
                            }
                            else{
                            resetButtons(a.tabName,formPanel);
                            setU1DefaultValues(formPanel,"");
                            }
                },
                 before_eam_beforesaverecord: function (a, b, c) {
                    if (a.userFunction === "WSJOBO" && a.tabName === "U1") {
						var formPanel = this.getFormPanel();
						setLineNo(formPanel);
					}
				 }
            },
            '[extensibleFramework] [tabName=ACT]': {
                afterrender: function (a, b) {
                  try{
                  EAM.Utils.debugMessage("afterrender function called !");
                  debugger;
                            var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                    
                                     
                  } catch (e) {
                            EAM.Utils.debugMessage('Error in After Render : ' + e);
                  }
                },
                afterloadrecord: function (a, b, c) {
                EAM.Utils.debugMessage("afterloadrecord function called !");
                             var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afterrecordchange: function (a, b) {
                  EAM.Utils.debugMessage("afterrender function called !");
                             var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afternewrecord: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afterreset: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                },
                aftersaverecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                },
                afterdestroyrecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                }
            },
            '[extensibleFramework] [tabName=CLO]': {
                afterrender: function (a, b) {
                  try{
                  EAM.Utils.debugMessage("afterrender function called !");
                  debugger;
                            var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                    
                                     
                  } catch (e) {
                            EAM.Utils.debugMessage('Error in After Render : ' + e);
                  }
                },
                afterloadrecord: function (a, b, c) {
                EAM.Utils.debugMessage("afterloadrecord function called !");
                             var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afterrecordchange: function (a, b) {
                  EAM.Utils.debugMessage("afterrender function called !");
                             var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afternewrecord: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afterreset: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                },
                aftersaverecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                },
                afterdestroyrecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                }
            },
            '[extensibleFramework] [tabName=CMT]': {
                afterrender: function (a, b) {
                  try{
                  EAM.Utils.debugMessage("afterrender function called !");
                  debugger;
                            var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                    
                                     
                  } catch (e) {
                            EAM.Utils.debugMessage('Error in After Render : ' + e);
                  }
                },
                afterloadrecord: function (a, b, c) {
                EAM.Utils.debugMessage("afterloadrecord function called !");
                             var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afterrecordchange: function (a, b) {
                  EAM.Utils.debugMessage("afterrender function called !");
                             var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afternewrecord: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }

                },
                afterreset: function (a) {
                  EAM.Utils.debugMessage("afterrender function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                },
                aftersaverecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                },
                afterdestroyrecord: function (a, b, c) {
                    EAM.Utils.debugMessage("aftersaverecord function called !");
                            var formPanel = this.getFormPanel();
                     var formPanel = this.getFormPanel();
                            var headerStatus = formPanel.screen._listView.activeRecord.data.workorderstatus;
                            var userGroup = getUserGroup();
            
                            if((userGroup === "SUPPLIER" && headerStatus === "IC" ) ||
                            headerStatus === "AG" || headerStatus === "CA" || headerStatus === "TF"){
                            protectAllFields(a.tabName,formPanel);
                            return;
                            }else{
                            resetButtons(a.tabName,formPanel);
                            }
                }
            }
            
        }
    }
    
});
function beforeTabChange(formPanel,fieldName){
debugger;
};
function setDropDowns(formPanel,fieldName){
var vFld = formPanel.getFld(fieldName);
var vFldParentContainer = vFld.up('container');
var vFldIndx = vFldParentContainer.items.keys.indexOf(vFld.id);
var requestData = {
                                GRID_NAME: "LVSUPACT",
                                GRID_TYPE: "LOV",
                                REQUEST_TYPE: "LOV.HEAD_DATA.STORED",
                                LOV_ALIAS_NAME_1: "parameter.eventnum",
                                LOV_ALIAS_VALUE_1: formPanel.getFldValue("wspf_10_ou_wo"),
                                LOV_ALIAS_TYPE_1: "text",
                                LOV_ALIAS_NAME_2: "parameter.language",
                                LOV_ALIAS_VALUE_2: EAM.AppData.getLanguage(),
                                CURRENT_TAB_NAME: userFunctionTab,
                                USER_FUNCTION_NAME: userFunction,
                                SYSTEM_FUNCTION_NAME: "BSUDSC",
                                COMPONENT_INFO_TYPE: "DATA_ONLY"
                            };

                            var response = EAM.Ajax.request({
                                url: "LOVPOP",
                                params: requestData
                            });
                            var vrecords = response.responseData.pageData.grid.GRIDRESULT.GRID.DATA;
                            var vdata = [];
                            for (var i = 0; i < vrecords.length; i++) {
                                vdata.push({
                                    "abbr": vrecords[i].lvsupactcode,
                                    "name": vrecords[i].lvsupactdesc
                                });
                            }


var dropDwonStore = Ext.create('Ext.data.Store', {
                                fields: ['abbr', 'name'],
                                data: vdata
                            });
myDropDown = Ext.create('Ext.form.ComboBox', {
                                fieldLabel: 'Activity',
                                id: 'myDropDown',
                                name: 'custstatus',
                                store: dropDwonStore,
                                queryMode: 'local',
                                displayField: 'name',
                                valueField: 'abbr',
                                typeAhead: 1,
                                typeAheadDelay: 250,
                                assertValue: function () {
                                debugger;
                                    console.log("assertValue called for status");
                                    var a = this,
                                        e = a.getRawValue(),
                                        d = a.getDisplayValue(),
                                        c = a.lastSelectedRecords,
                                        g = !1,
                                        f,
                                        b;
                                    b = a.findRecordByDisplay(f);
                                    if (b && (b !== (c && c[0]) || a.displayField !== a.valueField)) {
                                        a.select(b, !0);
                                        a.fireEvent('select', a, b)
                                    } else {
                                        var check = "NOTDIRTY";
                                        if (!Ext.isEmpty(c)) {
                                            a.setValue(c[0].data.name);
                                            if (c[0].data.abbr == gActivityValue) {
                                                check = "DIRTY";
                                            }
                                        } else {
                                            var vActivityCode = gActivityValue;
                                            var availableActivity = a.store.config.data;
                                            var vActivityDesc = "";
                                            if (vActivityCode == "-") {
                                                vActivityDesc = availableActivity[0].name;
                                            } else {
                                                for (var i = 0; i < availableActivity.length; i++) {
                                                    if (vActivityCode == availableActivity[i].abbr) {
                                                        vActivityDesc = availableActivity[i].name;
                                                        break;
                                                    }
                                                }
                                            }
                                            a.setValue(vActivityDesc);
                                            check = "DIRTY";
                                        }
                                        if (check == "DIRTY") {
                                            if (a.mixins && a.mixins.field && typeof a.mixins.field['initValue'] == 'function') {
                                                a.mixins.field.initValue.apply(a);
                                                a.wasDirty = false;
                                            }
                                        }
                                    }
                                    
                                    a.collapse()
                                },
                                listeners: {
                                    'select': function (combo, records) {
                                        vcurrentRecord = records.data.abbr;
                                        EAM.Utils.debugMessage("value of selected record : " + vcurrentRecord)
                                        var vPageMode = formPanel.getFldValue("pagemode");
                                        //if (vPageMode === "display") {
                                        //    formPanel.setFldValue("wspf_10_ou_act", "-", true);
                                        //} else if (vPageMode === "view") {
                                            formPanel.setFldValue("wspf_10_ou_act", vcurrentRecord, true);
                                            var actFld = formPanel.getFld("wspf_10_ou_act");
                                            actFld.fireEvent('customonblur', actFld,vcurrentRecord);
                                        //}
                                    }
                                }
                            });
                            vFldParentContainer.add(+vFldIndx + 1, myDropDown);
                            //formPanel.setFldValue("myDropDown", vdata[0].abbr, true);
                            //formPanel.setFldValue("wspf_10_ou_act", vdata[0].abbr, true);
                            //gActivityValue = formPanel.getFldValue("wspf_10_ou_act");

};
function protectHdrField(formPanel, pAction) {
    EAM.Utils.debugMessage("protectHdrField function called !");
    gStatusValue = formPanel.getFldValue("workorderstatus");
    if (gStatusValue === "AL") {
        h = {
            "udfchar22": "required"
        };
        EAM.Builder.setFieldState(h, formPanel.getForm().getFields());
        
    } else {
     h = {
            "udfchar22": "protected"
        };
        EAM.Builder.setFieldState(h, formPanel.getForm().getFields());
    }
    var userGroup = getUserGroup();
    if(userGroup === "SUPPLIER"){
     h = {
            "udfchar19": "protected"
        };
        EAM.Builder.setFieldState(h, formPanel.getForm().getFields());
    }else if (gStatusValue === "W") {
        h = {
            "udfchar19": "optional"
        };
        EAM.Builder.setFieldState(h, formPanel.getForm().getFields());
        
    } else {
     h = {
            "udfchar19": "protected"
        };
        EAM.Builder.setFieldState(h, formPanel.getForm().getFields());
    }
    var vPageMode = formPanel.getFldValue("pagemode");
    if (vPageMode === "view") {
        h = {
            "equipment": "protected",
            "department": "protected",
            "workordertype":"protected",
            "problemcode":"protected",
            "priority":"protected"
        };
        EAM.Builder.setFieldState(h, formPanel.getForm().getFields());
        
    }
};
function getUserGroup() {
    var requestData = {
        GRID_NAME: "QUUGRP",
        GRID_TYPE: "LOV",
        REQUEST_TYPE: "LOV.HEAD_DATA.STORED",
        LOV_ALIAS_NAME_1: "parameter.usrcode",
        LOV_ALIAS_VALUE_1: EAM.AppData.getUser(),
        LOV_ALIAS_TYPE_1: "text",
        CURRENT_TAB_NAME: "HDR",
        USER_FUNCTION_NAME: "QUUGRP",
        SYSTEM_FUNCTION_NAME: "BSUDSC",
        COMPONENT_INFO_TYPE: "DATA_ONLY"
    };

    var response = EAM.Ajax.request({
        url: "LOVPOP",
        params: requestData
    });
    return response.responseData.pageData.grid.GRIDRESULT.GRID.DATA[0].usrgroup;
};
function setLineNo(formPanel)
{
	  //Setting next sequence no on TAB
	         var vWoSeq = getSequenceNo(formPanel.getFldValue("wspf_10_ou_wo"),formPanel.screen._listView.activeRecord.data.organization,formPanel.screen._listView.activeRecord.data.workorderrtype);
						   if (vWoSeq === 0) {
                                if (Ext.isEmpty(formPanel.getFldValue("wspf_10_ou_line"))) {
									
                                    formPanel.setFldValue("wspf_10_ou_line", 10, true);
                                }
                            } else {
                                if (Ext.isEmpty(formPanel.getFldValue("wspf_10_ou_line"))) {
                                    formPanel.setFldValue("wspf_10_ou_line", +vWoSeq + 10, true);
                                }
                            }
};
function setU1DefaultValues(formPanel, pAction) {
    EAM.Utils.debugMessage("setU1DefaultValues function called !");
    debugger;
                    var todayDate = new Date();
				    todayDate = Ext.Date.format(todayDate, 'm/d/Y H:i');
					console.log("todayDate: " + todayDate);
                    formPanel.setFldValue("wspf_10_ou_date1", todayDate,true);
                    formPanel.setFldValue("wspf_10_ou_date", todayDate, true);
                    formPanel.setFldValue("wspf_10_ou_date2", todayDate, true);
                   
                       

    maintainFormPanelState(formPanel);
};
function getSequenceNo(vWoCode,woOrganization,woType) {
    try {
        var vRequest = {
            SYSTEM_FUNCTION_NAME: "BSUDSC",
            USER_FUNCTION_NAME: userFunction,
            CURRENT_TAB_NAME: userFunctionTab,
            workordernum: vWoCode,
            organization: woOrganization,
            workorderrtype: woType,
            GRID_NAME: userFunction + '_' + userFunctionTab,
            ADDON_SORT_ELEMENT_ALIAS_NAME: 'wspf_10_ou_line',
            ADDON_SORT_ELEMENT_TYPE: 'DESC',
            COMPONENT_INFO_TYPE: 'DATA_ONLY',
        };
        var response = EAM.Ajax.request({
            url: "BSUDSC.TAB.xmlhttp",
            params: vRequest
        });
        var vSeq = "";
        var vrecords = response.responseData.pageData.grid.GRIDRESULT.GRID.DATA;
        if (vrecords.length > 0) {
            vSeq = vrecords[0].wspf_10_ou_line
        } else if (vrecords.length === 0) {
            vSeq = 0;
        }
        return vSeq;
    } catch (err) {
        EAM.Utils.debugMessage("getSequenceNo err :" + err);
    }

};
function overridelovfield(pFormPanel, pField) {
    try {
        EAM.Utils.debugMessage("external function called !");
      
        DEBUG && console.log('pField');
        DEBUG && console.log(pField.name);
        DEBUG && console.log(pField);

        var vLovName = '';
        var vInputVars = {};
        var vReturnFields = {};
        var vClearFields = [];

        pField.extraLOVParams = null;

        if (pField.name == 'wspf_10_ou_parts') {
            vLovName = 'LVPARTSUP';
            vInputVars = {
                'parameter.workordernum': pFormPanel.getFldValue("wspf_10_ou_wo")
            };
            vReturnFields = {
                wspf_10_ou_parts: "lvpartsupcatcode"
            };
        }else if (pField.name == 'wspf_10_ou_toh') {
            vLovName = 'LVSUPHRS';
            vInputVars = {
                'parameter.language': EAM.AppData.getLanguage(),
                'parameter.wonum': pFormPanel.getFldValue("wspf_10_ou_wo"),
                'parameter.trde': pFormPanel.getFldValue("wspf_10_ou_trade")
            };
            vReturnFields = {
                wspf_10_ou_toh: "lvsupdescode"
            };
        }

        if (!Ext.isEmpty(vLovName)) {
            var vLookUpLOV = vValidateLOV = {
                lovName: vLovName,
                inputVars: vInputVars,
                returnFields: vReturnFields
            };

            vValidateLOV.clearFields = vClearFields;

            pField.lookupLOV = vLookUpLOV;
            pField.validateLOV = vValidateLOV;

            pField.extraLOVParams = pField.extraLOVParams || null;
            pField.isQueryCode = false;
            pField.fetchMoreRequestType = null;

            pField.validateOnBlur = true;
            pField.validateOnChange = true;
            pField.useBeforeValidateLOV = false;

            pField.dataspyConfig = {
                hideDataspyList: !1,
                hideEditButton: !1,
                hideExcelButton: !1,
                noFilterRow: !1,
                dataspyXType: 'dataspy'
            };
        }

        DEBUG && console.log('pField');
        DEBUG && console.log(pField);

        EAM.Utils.debugMessage("Code Executed : ");
    } catch (err) {
        EAM.Utils.debugMessage("overridelovfield err :" + err);
    }

};
/***
 *** function to maintain
 *** formPanel State after adding
 *** creating custom fields
 ***/
function maintainFormPanelState(formPanel) {
    var items = formPanel.getForm().getFields().items,
        i = 0,
        len = items.length;
    for (; i < len; i++) {
        var c = items[i];
        if (c.mixins && c.mixins.field && typeof c.mixins.field['initValue'] == 'function') {
            c.mixins.field.initValue.apply(c);
            c.wasDirty = false;
        }
    }
};
function protectAllFields(tabName,formPanel) {
        var a = formPanel.getForm().getFieldsAndButtons();
        if (tabName ==='ACT' || tabName ==='CLO' || tabName ==='CMT' || tabName ==='U1' || tabName ==='HDR') {
        
        var h = {
        
        };
        
        for (var i=0; i < a.keys.length; i++) {
            var c = a.keys[i];
            if(tabName === 'HDR' && c === 'workorderstatus'){
                continue;
            }
            h[c] = "protected";
           
            }
            EAM.Builder.setFieldState(h, formPanel.getForm().getFields());
            if(tabName != 'HDR'){
                if(formPanel.down("button[action=deleteRec]")){
                    formPanel.down("button[action=deleteRec]").setDisabled(true);
                }
                if(formPanel.down("button[action=newRec]")){
                    formPanel.down("button[action=newRec]").setDisabled(true);
                }
                if(formPanel.down("button[action=saveRec]")){
                    formPanel.down("button[action=saveRec]").setDisabled(true);
                }
                if(formPanel.down("button[action=clearRec]")){
                    formPanel.down("button[action=clearRec]").setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#addeditcomments')[0]){
                    Ext.ComponentQuery.query('#addeditcomments')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#viewpmactivitycomments')[0]){
                    Ext.ComponentQuery.query('#viewpmactivitycomments')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#adddeferredactivity')[0]){
                    Ext.ComponentQuery.query('#adddeferredactivity')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#rellocatedirectmaterial')[0]){
                    Ext.ComponentQuery.query('#rellocatedirectmaterial')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#createlaborreq')[0]){
                    Ext.ComponentQuery.query('#createlaborreq')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#createwarrantyclaim')[0]){
                    Ext.ComponentQuery.query('#createwarrantyclaim')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#viewtaskinstructions')[0]){
                    Ext.ComponentQuery.query('#viewtaskinstructions')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#adddocumotodetails')[0]){
                    Ext.ComponentQuery.query('#adddocumotodetails')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#importactivities')[0]){
                    Ext.ComponentQuery.query('#importactivities')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#linearlocationdetails')[0]){
                    Ext.ComponentQuery.query('#linearlocationdetails')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#submit')[0]){
                    Ext.ComponentQuery.query('#submit')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#clear')[0]){
                    Ext.ComponentQuery.query('#clear')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#deleteactivity')[0]){
                    Ext.ComponentQuery.query('#deleteactivity')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('#newactivity')[0]){
                    Ext.ComponentQuery.query('#newactivity')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('common_comments button[action=destroy]')[0]){
                    Ext.ComponentQuery.query('common_comments button[action=destroy]')[0].setDisabled(true);
                }
                if(Ext.ComponentQuery.query('common_comments button[action=newComment]')[0]){
                    Ext.ComponentQuery.query('common_comments button[action=newComment]')[0].setDisabled(true);
                }
                 
            }
        } else {
            EAM.Builder.setFieldState({
                'pagelayout': 'optional'
            }, a)
        }
    };
    function resetButtons(tabName,formPanel) {
        var a = formPanel.getForm().getFieldsAndButtons();
        if (tabName ==='ACT' || tabName ==='CLO' || tabName ==='CMT' || tabName ==='U1') {
        
         
                if(formPanel.down("button[action=deleteRec]")){
                    formPanel.down("button[action=deleteRec]").setDisabled(false);
                }
                if(formPanel.down("button[action=newRec]")){
                    formPanel.down("button[action=newRec]").setDisabled(false);
                }
                if(formPanel.down("button[action=saveRec]")){
                    formPanel.down("button[action=saveRec]").setDisabled(false);
                }
                if(formPanel.down("button[action=clearRec]")){
                    formPanel.down("button[action=clearRec]").setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#addeditcomments')[0]){
                    Ext.ComponentQuery.query('#addeditcomments')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#viewpmactivitycomments')[0]){
                    Ext.ComponentQuery.query('#viewpmactivitycomments')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#adddeferredactivity')[0]){
                    Ext.ComponentQuery.query('#adddeferredactivity')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#rellocatedirectmaterial')[0]){
                    Ext.ComponentQuery.query('#rellocatedirectmaterial')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#createlaborreq')[0]){
                    Ext.ComponentQuery.query('#createlaborreq')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#createwarrantyclaim')[0]){
                    Ext.ComponentQuery.query('#createwarrantyclaim')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#viewtaskinstructions')[0]){
                    Ext.ComponentQuery.query('#viewtaskinstructions')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#adddocumotodetails')[0]){
                    Ext.ComponentQuery.query('#adddocumotodetails')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#importactivities')[0]){
                    Ext.ComponentQuery.query('#importactivities')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#linearlocationdetails')[0]){
                    Ext.ComponentQuery.query('#linearlocationdetails')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#submit')[0]){
                    Ext.ComponentQuery.query('#submit')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#clear')[0]){
                    Ext.ComponentQuery.query('#clear')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#deleteactivity')[0]){
                    Ext.ComponentQuery.query('#deleteactivity')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('#newactivity')[0]){
                    Ext.ComponentQuery.query('#newactivity')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('common_comments button[action=destroy]')[0]){
                    Ext.ComponentQuery.query('common_comments button[action=destroy]')[0].setDisabled(false);
                }
                if(Ext.ComponentQuery.query('common_comments button[action=newComment]')[0]){
                    Ext.ComponentQuery.query('common_comments button[action=newComment]')[0].setDisabled(false);
                }
            
        }
    };
function setActivityStore(formPanel) {
    
    EAM.Utils.debugMessage("external function to set store");
    var vActivityCode = "-";
    if (!Ext.isEmpty(formPanel.getFldValue("wspf_10_ou_act"))) {
        vActivityCode = formPanel.getFldValue("wspf_10_ou_act");
    }
    try {
        var requestData = {
                                GRID_NAME: "LVSUPACT",
                                GRID_TYPE: "LOV",
                                REQUEST_TYPE: "LOV.HEAD_DATA.STORED",
                                LOV_ALIAS_NAME_1: "parameter.eventnum",
                                LOV_ALIAS_VALUE_1: formPanel.getFldValue("wspf_10_ou_wo"),
                                LOV_ALIAS_TYPE_1: "text",
                                LOV_ALIAS_NAME_2: "parameter.language",
                                LOV_ALIAS_VALUE_2: EAM.AppData.getLanguage(),
                                CURRENT_TAB_NAME: userFunctionTab,
                                USER_FUNCTION_NAME: userFunction,
                                SYSTEM_FUNCTION_NAME: "BSUDSC",
                                COMPONENT_INFO_TYPE: "DATA_ONLY"
                            };

                            var response = EAM.Ajax.request({
                                url: "LOVPOP",
                                params: requestData
                            });
                            var vrecords = response.responseData.pageData.grid.GRIDRESULT.GRID.DATA;
                            var vdata = [];
                            for (var i = 0; i < vrecords.length; i++) {
                                vdata.push({
                                    "abbr": vrecords[i].lvsupactcode,
                                    "name": vrecords[i].lvsupactdesc
                                });
                            }


var dropDownStore = Ext.create('Ext.data.Store', {
                                fields: ['abbr', 'name'],
                                data: vdata
                            });
        //if (vdata.length > 0 ){
        formPanel.setFldValue("myDropDown", '', true);
            myDropDown.setStore(dropDownStore);
        //}
        
        if (vdata.length > 0 && vActivityCode != '-') {
            myDropDown.setValue(vActivityCode);
            formPanel.setFldValue("wspf_10_ou_act", vActivityCode, true);
            var actFld = formPanel.getFld("wspf_10_ou_act");
            actFld.fireEvent('customonblur', actFld,vActivityCode);
            
        }else{
            //myDropDown.setValue(vdata[0].abbr);
            //formPanel.setFldValue("wspf_10_ou_act", vdata[0].abbr, true);
            //var actFld = formPanel.getFld("wspf_10_ou_act");
            //actFld.fireEvent('customonblur', actFld,vdata[0].abbr);
            
        }
        
    } catch (e) {
        EAM.Utils.debugMessage('Error in Set Store : ' + e);
    }
};
/*Function to generate a popup for type Damage or Monthly Invoice Unchecked*/
function showPopup() {
	var langmsg="";
		var vuserLang = EAM.AppData.getInstallParams().get("language");
		if( vuserLang === "NL" ){
		langmsg = "Weet je zeker dat je de status wil veranderen? Er wordt dan een automatische inkooporder gemaakt";
		}else{
		langmsg = "Are you sure you want to change the status? An automatic PO will be generated";
		}
		
    EAM.Messaging.showQuestion({
        msg: langmsg,
        buttons: EAM.MsgBox.YESNO,
        fn: function (g) {
            if (g === "yes") {
                //formPanel.setFldValue("workorderstatus", headerStatus, true);
                var saveButton = EAM.Utils.getMainToolbar().down("button[action=saveRec]");
                saveButton.fireEvent("click", saveButton);
                //vReturnVar = true;
            } else {
                if (g === "no") {
                    var resetButton = EAM.Utils.getMainToolbar().getResetButton();
                    resetButton.fireEvent("click", resetButton);
                    //vReturnVar = false;
                    return false;
                }
            }
        },
        scope: this
    })
};